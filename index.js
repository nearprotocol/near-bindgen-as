!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("assemblyscript")):"function"==typeof define&&define.amd?define(["assemblyscript"],e):"object"==typeof exports?exports.transformer=e(require("assemblyscript")):t.transformer=e(t.assemblyscript)}("undefined"!=typeof self?self:this,(function(t){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){"use strict";function s(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),s(i(1)),s(i(4))},function(e,i){e.exports=t},function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.depth=0,e}return n(e,t),e.prototype._visit=function(t){switch(t.kind){case o.NodeKind.SOURCE:this.visitSource(t);break;case o.NodeKind.NAMEDTYPE:this.visitNamedTypeNode(t);break;case o.NodeKind.FUNCTIONTYPE:this.visitFunctionTypeNode(t);break;case o.NodeKind.TYPENAME:this.visitTypeName(t);case o.NodeKind.TYPEPARAMETER:this.visitTypeParameter(t);break;case o.NodeKind.FALSE:case o.NodeKind.NULL:case o.NodeKind.SUPER:case o.NodeKind.THIS:case o.NodeKind.TRUE:case o.NodeKind.CONSTRUCTOR:case o.NodeKind.IDENTIFIER:this.visitIdentifierExpression(t);break;case o.NodeKind.ASSERTION:this.visitAssertionExpression(t);break;case o.NodeKind.BINARY:this.visitBinaryExpression(t);break;case o.NodeKind.CALL:this.visitCallExpression(t);break;case o.NodeKind.CLASS:this.visitClassExpression(t);break;case o.NodeKind.COMMA:this.visitCommaExpression(t);break;case o.NodeKind.ELEMENTACCESS:this.visitElementAccessExpression(t);break;case o.NodeKind.FUNCTION:this.visitFunctionExpression(t);break;case o.NodeKind.INSTANCEOF:this.visitInstanceOfExpression(t);break;case o.NodeKind.LITERAL:this.visitLiteralExpression(t);break;case o.NodeKind.NEW:this.visitNewExpression(t);break;case o.NodeKind.PARENTHESIZED:this.visitParenthesizedExpression(t);break;case o.NodeKind.PROPERTYACCESS:this.visitPropertyAccessExpression(t);break;case o.NodeKind.TERNARY:this.visitTernaryExpression(t);break;case o.NodeKind.UNARYPOSTFIX:this.visitUnaryPostfixExpression(t);break;case o.NodeKind.UNARYPREFIX:this.visitUnaryPrefixExpression(t);break;case o.NodeKind.BLOCK:this.visitBlockStatement(t);break;case o.NodeKind.BREAK:this.visitBreakStatement(t);break;case o.NodeKind.CONTINUE:this.visitContinueStatement(t);break;case o.NodeKind.DO:this.visitDoStatement(t);break;case o.NodeKind.EMPTY:this.visitEmptyStatement(t);break;case o.NodeKind.EXPORT:this.visitExportStatement(t);break;case o.NodeKind.EXPORTDEFAULT:this.visitExportDefaultStatement(t);break;case o.NodeKind.EXPORTIMPORT:this.visitExportImportStatement(t);break;case o.NodeKind.EXPRESSION:this.visitExpressionStatement(t);break;case o.NodeKind.FOR:this.visitForStatement(t);break;case o.NodeKind.IF:this.visitIfStatement(t);break;case o.NodeKind.IMPORT:this.visitImportStatement(t);break;case o.NodeKind.RETURN:this.visitReturnStatement(t);break;case o.NodeKind.SWITCH:this.visitSwitchStatement(t);break;case o.NodeKind.THROW:this.visitThrowStatement(t);break;case o.NodeKind.TRY:this.visitTryStatement(t);break;case o.NodeKind.VARIABLE:this.visitVariableStatement(t);break;case o.NodeKind.WHILE:this.visitWhileStatement(t);break;case o.NodeKind.CLASSDECLARATION:this.visitClassDeclaration(t);break;case o.NodeKind.ENUMDECLARATION:this.visitEnumDeclaration(t);break;case o.NodeKind.ENUMVALUEDECLARATION:this.visitEnumValueDeclaration(t);break;case o.NodeKind.FIELDDECLARATION:this.visitFieldDeclaration(t);break;case o.NodeKind.FUNCTIONDECLARATION:this.visitFunctionDeclaration(t);break;case o.NodeKind.IMPORTDECLARATION:this.visitImportDeclaration(t);break;case o.NodeKind.INDEXSIGNATUREDECLARATION:this.visitIndexSignatureDeclaration(t);break;case o.NodeKind.INTERFACEDECLARATION:this.visitInterfaceDeclaration(t);break;case o.NodeKind.METHODDECLARATION:this.visitMethodDeclaration(t);break;case o.NodeKind.NAMESPACEDECLARATION:this.visitNamespaceDeclaration(t);break;case o.NodeKind.TYPEDECLARATION:this.visitTypeDeclaration(t);break;case o.NodeKind.VARIABLEDECLARATION:this.visitVariableDeclaration(t);break;case o.NodeKind.DECORATOR:this.visitDecoratorNode(t);break;case o.NodeKind.EXPORTMEMBER:this.visitExportMember(t);break;case o.NodeKind.PARAMETER:this.visitParameter(t);break;case o.NodeKind.SWITCHCASE:this.visitSwitchCase(t);break;default:assert(!1)}},e.prototype.visitSource=function(t){var e,i;try{for(var s=r(t.statements),n=s.next();!n.done;n=s.next()){var o=n.value;this.depth++,this.visit(o),this.depth--}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}},e.prototype.visitTypeNode=function(t){},e.prototype.visitTypeName=function(t){this.visit(t.identifier),t.next&&this.visit(t.next)},e.prototype.visitNamedTypeNode=function(t){this.visit(t.name),this.visit(t.typeArguments)},e.prototype.visitFunctionTypeNode=function(t){var e,i;try{for(var s=r(t.parameters),n=s.next();!n.done;n=s.next()){var o=n.value;this.visit(o)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}this.visit(t.returnType)},e.prototype.visitTypeParameter=function(t){this.visit(t.name),t.extendsType&&this.visit(t.extendsType),t.defaultType&&this.visit(t.defaultType)},e.prototype.visitIdentifierExpression=function(t){},e.prototype.visitArrayLiteralExpression=function(t){var e=this;t.elementExpressions.map((function(t){t&&e.visit(t)}))},e.prototype.visitObjectLiteralExpression=function(t){if(t.values&&t.names){assert(t.values.length==t.names.length);for(var e=0;e<t.values.length;e++)this.visit(t.names[e]),this.visit(t.values[e])}},e.prototype.visitAssertionExpression=function(t){t.toType&&this.visit(t.toType),this.visit(t.expression)},e.prototype.visitBinaryExpression=function(t){this.visit(t.left),this.visit(t.right)},e.prototype.visitCallExpression=function(t){this.visit(t.expression),this.visit(t.typeArguments),this.visit(t.arguments)},e.prototype.visitClassExpression=function(t){this.visit(t.declaration)},e.prototype.visitCommaExpression=function(t){this.visit(t.expressions)},e.prototype.visitElementAccessExpression=function(t){this.visit(t.elementExpression),this.visit(t.expression)},e.prototype.visitFunctionExpression=function(t){this.visit(t.declaration)},e.prototype.visitLiteralExpression=function(t){},e.prototype.visitFloatLiteralExpression=function(t){},e.prototype.visitInstanceOfExpression=function(t){this.visit(t.expression),this.visit(t.isType)},e.prototype.visitIntegerLiteralExpression=function(t){},e.prototype.visitStringLiteral=function(t,e){},e.prototype.visitStringLiteralExpression=function(t){},e.prototype.visitRegexpLiteralExpression=function(t){},e.prototype.visitNewExpression=function(t){this.visit(t.expression),this.visit(t.typeArguments),this.visit(t.arguments)},e.prototype.visitParenthesizedExpression=function(t){this.visit(t.expression)},e.prototype.visitPropertyAccessExpression=function(t){this.visit(t.property),this.visit(t.expression)},e.prototype.visitTernaryExpression=function(t){this.visit(t.condition),this.visit(t.ifThen),this.visit(t.ifElse)},e.prototype.visitUnaryExpression=function(t){this.visit(t.operand)},e.prototype.visitUnaryPostfixExpression=function(t){this.visit(t.operand)},e.prototype.visitUnaryPrefixExpression=function(t){this.visit(t.operand)},e.prototype.visitSuperExpression=function(t){},e.prototype.visitFalseExpression=function(t){},e.prototype.visitTrueExpression=function(t){},e.prototype.visitThisExpression=function(t){},e.prototype.visitNullExperssion=function(t){},e.prototype.visitConstructorExpression=function(t){},e.prototype.visitNodeAndTerminate=function(t){},e.prototype.visitBlockStatement=function(t){this.depth++,this.visit(t.statements),this.depth--},e.prototype.visitBreakStatement=function(t){t.label&&this.visit(t.label)},e.prototype.visitContinueStatement=function(t){t.label&&this.visit(t.label)},e.prototype.visitClassDeclaration=function(t,e){this.visit(t.name),this.depth++,this.visit(t.decorators),assert(t.isGeneric?null!=t.typeParameters:null==t.typeParameters),t.isGeneric&&this.visit(t.typeParameters),t.extendsType&&this.visit(t.extendsType),this.visit(t.implementsTypes),this.visit(t.members),this.depth--},e.prototype.visitDoStatement=function(t){this.visit(t.condition),this.visit(t.statement)},e.prototype.visitEmptyStatement=function(t){},e.prototype.visitEnumDeclaration=function(t,e){this.visit(t.name),this.visit(t.decorators),this.visit(t.values)},e.prototype.visitEnumValueDeclaration=function(t){this.visit(t.name),t.initializer&&this.visit(t.initializer)},e.prototype.visitExportImportStatement=function(t){this.visit(t.name),this.visit(t.externalName)},e.prototype.visitExportMember=function(t){this.visit(t.localName),this.visit(t.exportedName)},e.prototype.visitExportStatement=function(t){t.path&&this.visit(t.path),this.visit(t.members)},e.prototype.visitExportDefaultStatement=function(t){this.visit(t.declaration)},e.prototype.visitExpressionStatement=function(t){this.visit(t.expression)},e.prototype.visitFieldDeclaration=function(t){this.visit(t.name),t.type&&this.visit(t.type),t.initializer&&this.visit(t.initializer),this.visit(t.decorators)},e.prototype.visitForStatement=function(t){t.initializer&&this.visit(t.initializer),t.condition&&this.visit(t.condition),t.incrementor&&this.visit(t.incrementor),this.visit(t.statement)},e.prototype.visitFunctionDeclaration=function(t,e){this.visit(t.name),this.visit(t.decorators),t.isGeneric&&this.visit(t.typeParameters),this.visit(t.signature),this.depth++,t.body&&this.visit(t.body),this.depth--},e.prototype.visitFunctionCommon=function(t){},e.prototype.visitIfStatement=function(t){this.visit(t.condition),this.visit(t.ifTrue),t.ifFalse&&this.visit(t.ifFalse)},e.prototype.visitImportDeclaration=function(t){this.visit(t.foreignName),this.visit(t.name),this.visit(t.decorators)},e.prototype.visitImportStatement=function(t){t.namespaceName&&this.visit(t.namespaceName),this.visit(t.declarations)},e.prototype.visitIndexSignatureDeclaration=function(t){},e.prototype.visitInterfaceDeclaration=function(t,e){this.visit(t.name),t.isGeneric&&this.visit(t.typeParameters),this.visit(t.implementsTypes),t.extendsType&&this.visit(t.extendsType),this.depth++,this.visit(t.members),this.depth--},e.prototype.visitMethodDeclaration=function(t){this.visit(t.name),t.isGeneric&&this.visit(t.typeParameters),this.visit(t.signature),this.visit(t.decorators),this.depth++,t.body&&this.visit(t.body),this.depth--},e.prototype.visitNamespaceDeclaration=function(t,e){this.visit(t.name),this.visit(t.decorators),this.visit(t.members)},e.prototype.visitReturnStatement=function(t){t.value&&this.visit(t.value)},e.prototype.visitSwitchCase=function(t){t.label&&this.visit(t.label),this.visit(t.statements)},e.prototype.visitSwitchStatement=function(t){this.visit(t.condition),this.depth++,this.visit(t.cases),this.depth--},e.prototype.visitThrowStatement=function(t){this.visit(t.value)},e.prototype.visitTryStatement=function(t){this.visit(t.statements),t.catchVariable&&this.visit(t.catchVariable),this.visit(t.catchStatements),this.visit(t.finallyStatements)},e.prototype.visitTypeDeclaration=function(t){this.visit(t.name),this.visit(t.decorators),this.visit(t.type),this.visit(t.typeParameters)},e.prototype.visitVariableDeclaration=function(t){this.visit(t.name),t.type&&this.visit(t.type),t.initializer&&this.visit(t.initializer)},e.prototype.visitVariableStatement=function(t){this.visit(t.decorators),this.visit(t.declarations)},e.prototype.visitWhileStatement=function(t){this.visit(t.condition),this.depth++,this.visit(t.statement),this.depth--},e.prototype.visitVoidStatement=function(t){},e.prototype.visitComment=function(t){},e.prototype.visitDecoratorNode=function(t){this.visit(t.name),this.visit(t.arguments)},e.prototype.visitParameter=function(t){this.visit(t.name),t.implicitFieldDeclaration&&this.visit(t.implicitFieldDeclaration),t.initializer&&this.visit(t.initializer),this.visit(t.type)},e}(i(6).AbstractVisitor);e.BaseVisitor=a},function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=i(0),o=i(5),a=i(7);function p(t){return t.text.includes("@nearfile")||u(t)}function h(t){return a.ASTBuilder.build(t)}function u(t){return(t.kind==r.NodeKind.SOURCE?t:t.range.source).sourceKind==r.SourceKind.USER_ENTRY}function l(t){return t.kind==r.NodeKind.CLASSDECLARATION}function c(t){return t.kind==r.NodeKind.FIELDDECLARATION}var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.typeMapping={i32:"Integer",u32:"Integer",i64:"String",u64:"String",string:"String",bool:"Boolean",Uint8Array:"String"},e.nonNullableTypes=["i32","u32","i64","u64","bool","boolean"],e.sb=[],e.exportedClasses=new Map,e.wrappedFuncs=new Set,e}return n(e,t),e.build=function(t,i){return(new e).build(i)},e.nearFiles=function(t){return t.program.sources.filter(p)},e.prototype.visitClassDeclaration=function(e){this.exportedClasses.has(h(e.name))||this.exportedClasses.set(h(e.name),e),t.prototype.visitClassDeclaration.call(this,e)},e.prototype.visitFunctionDeclaration=function(e){!u(e)||this.wrappedFuncs.has(h(e.name))||!e.is(r.CommonFlags.EXPORT)||0==function(t){return t.signature.parameters.length}(e)&&function(t){return"void"===h(t.signature.returnType)}(e)?t.prototype.visitFunctionDeclaration.call(this,e):(this.generateWrapperFunction(e),e.flags=e.flags^r.CommonFlags.EXPORT,this.wrappedFuncs.add(h(e.name)),t.prototype.visit.call(this,e))},e.prototype.generateWrapperFunction=function(t){var e=t.signature,i=e.parameters,s=e.returnType,n=h(s).split("|").filter((function(t){return"null"!==t.trim()})).join("|"),r=h(s).includes("null"),o=t.name.symbol;this.sb.push("\n//@ts-ignore\nfunction __wrapper_"+o+"(): void {"),i.length>0&&this.sb.push(" const json = getInput();\n  read_register(0, <usize>json.buffer);\n  const obj: Obj = JSON.parse(json);"),"void"!==h(s)?this.sb.push("  let result: "+h(s)+" = "+o+"("):this.sb.push("  "+o+"("),i.length>0&&(this.sb[this.sb.length-1]+=i.map((function(t){return v(t)})).join(", ")),this.sb[this.sb.length-1]+=");","void"!==h(s)&&this.sb.push("\n  let encoder = new JSONEncoder();\n  let val: Uint8Array;\n  if ((isString<"+n+">() || isNullable<"+n+">()) && result == null) {\n    encoder.setNull(null);\n    val = encoder.serialize();\n  } else {\n    val = encode<"+n+">(result"+(r?"!":"")+", null, encoder);\n  }\n  value_return(val.byteLength, <usize>val.buffer);"),this.sb.push("}\n\nexport { __wrapper_"+o+" as "+o+" }\n")},e.prototype.typeName=function(t){if(!l(t))return a.ASTBuilder.build(t);var e=h((t=t).name);return t.isGeneric&&(e+="<"+t.typeParameters.map(h).join(", ")+">"),e},e.prototype.build=function(t){var e=this;this.sb=[m],this.visit(t);var i=t.statements.map((function(t){var i=a.ASTBuilder.build(t);if(l(t)){var s=t;if(i=i.slice(0,i.lastIndexOf("}")),s.members.filter(c).map((function(t){return t})).some((function(t){return null==t.type})))throw new Error("All Fields must have explict type declaration.");var n=e.typeName(s);i+="\n  decode<V = Uint8Array>(buf: V): "+n+' {\n    let json: Obj;\n    if (buf instanceof Uint8Array) {\n      json = JSON.parse(buf);\n    }else {\n      assert(buf instanceof Obj, "argument must be Uint8Array or Json Object");\n      json = <Obj> buf;\n    }\n    return this._decode(json);\n  }\n\n  private _decode(obj: Obj): '+n+" {\n    "+function(t){return t.members.filter(c).map((function(t){var e=h(t.name);return v(t,"this."+e+' = obj.has("'+e+'") ? ')+": this."+e+";"}))}(s).join("\n    ")+'\n    return this;\n  }\n\n  _encode(name: string | null = "", _encoder: JSONEncoder | null = null): JSONEncoder {\n    let encoder = (_encoder != null ? _encoder : new JSONEncoder())!;\n    encoder.pushObject(name);\n    '+function(t){return t.members.filter(c).map((function(t){var e=h(t.type),i=h(t.name);return"encode<"+e+", JSONEncoder>(this."+i+', "'+i+'", encoder);'}))}(s).join("\n    ")+"\n    encoder.popObject();\n    return encoder;\n  }\n  encode(): Uint8Array {\n    return this._encode().serialize();\n  }\n\n  serialize(): Uint8Array {\n    return this.encode();\n  }\n\n  toJSON(): string {\n    return this._encode().toString();\n  }\n}"}return i}));return this.sb.concat(i).join("\n")},e}(i(2).BaseVisitor);function v(t,e){return void 0===e&&(e=""),e+"decode<"+h(t.type)+', Obj>(obj, "'+h(t.name)+'")'}var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"program",{get:function(){return this.parser.program},enumerable:!0,configurable:!0}),e.prototype.afterParse=function(t){this.parser=t;var i=this.writeFile,s=this.baseDir,n=d.nearFiles(t);e.isTest=n.map((function(t){return t.normalizedPath})).some((function(t){return t.includes("spec")})),n.forEach((function(e){var n=e.text.substr(0,e.text.indexOf("\n")).includes("out");t.donelog.delete(e.internalPath),t.seenlog.delete(e.internalPath),t.program.sources=t.program.sources.filter((function(t){return t!==e}));var r=d.build(t,e);n&&i("out/"+e.normalizedPath,r,s),t.parseFile(r,(u(e)?"":"./")+e.normalizedPath,u(e))}));this.parser.parseFile('\nimport { base64 } from "near-runtime-ts";\nimport { JSONEncoder, JSONDecoder, ThrowingJSONHandler } from "assemblyscript-json";\nimport { u128 } from "bignum";\n// Runtime functions\n// tslint:disable: no-unsafe-any\n\ntype Usize = u64;\n//@ts-ignore\n@global\n@external("env", "read_register")\ndeclare function read_register(register_id: Usize, ptr: Usize): void;\n//@ts-ignore\n@global\n@external("env", "register_len")\ndeclare function register_len(register_id: Usize): Usize;\n\n//@ts-ignore\n@global\n@external("env", "input")\ndeclare function input(register_id: Usize): void;\n//@ts-ignore\n@global\n@external("env", "value_return")\ndeclare function value_return(value_len: Usize, value_ptr: Usize): void;\n//@ts-ignore\n@global\n@external("env", "panic")\ndeclare function panic(): void;\n//@ts-ignore\n@global\nfunction getInput(): Uint8Array { \n  // Reading input bytes.\n  input(0);\n  let json_len = register_len(0);\n  if (json_len == U32.MAX_VALUE) {\n    panic();\n  }\n  let json = new Uint8Array(json_len as u32);\n  //@ts-ignore\n  read_register(0, <usize>json.buffer);\n  return json;\n}\n\nabstract class Value {\n  static String(str: string): Value {\n    return new Str(str);\n  }\n  static Number(num: i64): Value {\n    return new Num(num);\n  }\n  static Bool(b: bool): Value {\n    return new Bools(b);\n  }\n  static Null(): Value {\n    return new Null();\n  }\n  static Array(): Value {\n    return new Arr();\n  }\n  static Object(): Value {\n    return new Obj();\n  }\n\n  toString(): string {\n    if (this instanceof Str) {\n      return (<Str>this).toString();\n    }\n    if (this instanceof Num) {\n      return (<Num>this).toString();\n    }\n    if (this instanceof Bools) {\n      return (<Bools>this).toString();\n    }\n    if (this instanceof Null) {\n      return (<Null>this).toString();\n    }\n    if (this instanceof Arr) {\n      return (<Arr>this).toString();\n    }\n    if (this instanceof Obj) {\n      return (<Obj>this).toString();\n    }\n    return "Value";\n  }\n}\n//@ts-ignore\n@global\nclass Str extends Value {\n  constructor(public _str: string) {\n    super();\n  }\n\n  toString(): string {\n    return "\\"" + this._str + "\\"";\n  }\n}\n//@ts-ignore\n@global\nclass Num extends Value {\n  constructor(public _num: i64) {\n    super();\n  }\n\n  toString(): string {\n    return this._num.toString();\n  }\n}\n//@ts-ignore\n@global\nclass Null extends Value {\n  constructor() {\n    super();\n  }\n\n  toString(): string {\n    return "null";\n  }\n}\n\n//@ts-ignore\n@global class Bools extends Value {\n  constructor(public _bool: bool) {\n    super();\n  }\n\n  toString(): string {\n    return this._bool.toString();\n  }\n}\n\n//@ts-ignore\n@global\nclass Arr extends Value {\n  _arr: Array<Value>;\n  constructor() {\n    super();\n    this._arr = new Array<Value>();\n  }\n\n  push(obj: Value): void {\n    this._arr.push(obj);\n  }\n\n  toString(): string {\n    return "[" + this._arr.map<string>((val: Value,i: i32,_arr: Value[]): string  => val.toString()).join(",") + "]";\n  }\n}\n\n//@ts-ignore\n@global\nclass Obj extends Value {\n  _obj: Map<string, Value>;\n  keys: Array<string>;\n\n  constructor() {\n    super();\n    this._obj = new Map();\n    this.keys = new Array();\n  }\n\n  set(key: string, value: Value): void {\n    if (!this._obj.has(key)) {\n      this.keys.push(key);\n    }\n    this._obj.set(key, value);\n  }\n\n  get(key: string): Value | null {\n    if (!this._obj.has(key)) {\n      return null;\n    }\n    return this._obj.get(key);\n  }\n\n  toString(): string {\n    const objs: string[] = [];\n    for (let i: i32 = 0; i < this.keys.length; i++) {\n      objs.push("\\"" + this.keys[i] + "\\":" + this._obj.get(this.keys[i]).toString());\n    }\n    return "{" + objs.join(",") + "}";\n  }\n\n  has(key: string): bool {\n    return this._obj.has(key);\n  }\n}\n\nclass Handler extends ThrowingJSONHandler {\n  stack: Value[];\n  constructor() {\n    super();\n    this.stack = new Array<Value>();\n  }\n\n  reset(): void {\n    while (this.stack.length > 0) {\n      this.stack.pop();\n    }\n  }\n\n  get peek(): Value {\n    return this.stack[this.stack.length - 1];\n  }\n\n  setString(name: string, value: string): void {\n    const obj: Value = Value.String(value);\n    this.addValue(name, obj);\n  }\n\n  setBoolean(name: string, value: bool): void {\n    const obj = Value.Bool(value);\n    this.addValue(name, obj);\n  }\n\n  setNull(name: string): void {\n    const obj = Value.Null();\n    this.addValue(name, obj);\n  }\n\n  setInteger(name: string, value: i64): void {\n    const obj = Value.Number(value);\n    this.addValue(name, obj);\n  }\n\n  pushArray(name: string): bool {\n    const obj: Value = Value.Array();\n    this.addValue(name, obj);\n    this.stack.push(obj);\n    return true;\n  }\n\n  popArray(): void {\n    if (this.stack.length > 1) {\n      this.stack.pop();\n    }\n  }\n\n  pushObject(name: string): bool {\n    const obj: Value = Value.Object();\n    this.addValue(name, obj);\n    this.stack.push(obj);\n    return true;\n  }\n\n  popObject(): void {\n    if (this.stack.length > 1) {\n      this.stack.pop();\n    }\n  }\n\n  addValue(name: string, obj: Value): void {\n    if (name.length == 0 && obj instanceof Obj && this.stack.length == 0) {\n      this.stack.push(obj);\n      return;\n    }\n    if (this.peek instanceof Obj) {\n      (this.peek as Obj).set(name, obj);\n    }\n    else if (this.peek instanceof Arr) {\n      (<Arr>this.peek).push(obj);\n    }\n  }\n}\n\n//@ts-ignore\n@global()\nclass JSON {\n  private static handler: Handler = new Handler();\n  private static decoder: JSONDecoder<Handler> = new JSONDecoder<Handler>(JSON.handler);\n  static parse(str: Uint8Array ): Obj {\n    JSON.decoder.deserialize(str);\n    const res = JSON.decoder.handler.peek as Obj;\n    JSON.decoder.handler.reset();\n    return res;\n  }\n}\n\n//@ts-ignore\n@global\nfunction encode<T, Output = Uint8Array>(value: T, name: string | null = "", encoder: JSONEncoder = new JSONEncoder()): Output {\n  if (isBoolean<T>()) {\n    //@ts-ignore\n    encoder.setBoolean(name, value);\n  } else if (isInteger<T>()) {\n    if (value instanceof i64 || value instanceof u64) {\n      //@ts-ignore\n      encoder.setString(name, value.toString());\n    } else {\n    //@ts-ignore\n      encoder.setInteger(name, value);\n    }\n    //@ts-ignore\n  } else if (value == <T>null) {\n    encoder.setNull(name);\n  } else if (isString<T>()) {\n    //@ts-ignore\n    encoder.setString(name, value);\n  } else if (isReference<T>()) {\n    if (isArrayLike<T>(value)) {\n      if (value instanceof Uint8Array) {\n        //@ts-ignore\n        encoder.setString(name, base64.encode(<Uint8Array> value));\n      } else {\n        encoder.pushArray(name);\n        for (let i: i32 = 0; i < value.length; i++) {\n          //@ts-ignore\n          encode<valueof<T>, JSONEncoder>(value[i], null, encoder);\n        }\n        encoder.popArray();\n      }\n    } else { // Is an object\n      if (value instanceof u128) {\n        encoder.setString(name, value.toString());\n      } else {\n        //@ts-ignore\n        value._encode(name, encoder);\n      }\n    }\n  } else {\n    throw new Error("Encoding failed");\n  }\n  var output: Output;\n  //@ts-ignore\n  if (output instanceof Uint8Array) {\n    //@ts-ignore\n    return <Output>encoder.serialize();\n  }\n  //@ts-ignore\n  assert( output instanceof JSONEncoder, "Bad return type for encoder");\n  //@ts-ignore\n  return <Output>encoder;\n}\n\n//@ts-ignore\n@inline\nfunction getStr(val: Value, name: String): string {\n  assert(val instanceof Str, "Value with Key: " + name + " is not a string or null");\n  return (<Str>val)._str;\n}\n\nfunction decodeArray<T>(val: Value, name: string): Array<T> {\n  assert(val instanceof Arr, "Value with Key: " + name + " is not an array or null.");\n  const res = new Array<T>();\n  const arr = (<Arr>val)._arr;\n  for (let i: i32 = 0; i < arr.length; i++) {\n    let item: T = decode<T, Value>(arr[i]);\n    res.push(item);\n  }\n  return res;\n}\n\nfunction isNullable<T>(): bool {\n  return isReference<T>() || isArrayLike<T>() || isNullable<T>() || isString<T>();\n}\n\n//@ts-ignore\n@global\nfunction decode<T, V = Uint8Array>(buf: V, name: string = ""): T {\n  const buffer = <Value>(buf instanceof Uint8Array ? JSON.parse(buf) : buf);\n  var val: Value;\n  if (buffer instanceof Obj && name != "") {\n    const obj: Obj = <Obj>buffer;\n    let res = obj.get(name);\n    if (res == null) {\n      //@ts-ignore\n      return <T>null;\n    }\n    val = res;\n  }else {\n    val = <Value> buffer;\n  }\n  if (val instanceof Null) {\n    assert(isNullable<T>(), "Key: " + name + " with type " + nameof<T>() + "is not nullable.");\n    //@ts-ignore\n    return <T>null;\n  }\n  if (isString<T>()) {\n    //@ts-ignore\n    return getStr(val, name);\n  }\n  if (isBoolean<T>()) {\n    assert(val instanceof Bools, "Value with Key: " +  name + " with type " + nameof<T>()  + " is not a string");\n    //@ts-ignore\n    return (<Bools>val)._bool;\n  }\n  var value: T;\n  if (isInteger<T>()) {\n    //@ts-ignore\n    if (value instanceof u64 || value instanceof i64) {\n      assert(val instanceof Str, "Value with Key: " +  name + " with type " + nameof<T>()  + " is an 64-bit integer and is expected to be encoded as a string");\n      let str = (<Str>val)._str;\n      //@ts-ignore\n      return <T>(val instanceof u64) ? U64.parseInt(str) : I64.parseInt(str);\n    }\n    assert(val instanceof Num, "Value with Key: " +  name + " with type " + nameof<T>()  + " is not an Integer");\n    //@ts-ignore\n    return <T>(<Num>val)._num;\n  }\n  assert(isReference<T>(), name + " with type " + nameof<T>() + " must be an integer, boolean, string, object, or array");\n  if (isArrayLike<T>()) {\n    //@ts-ignore\n    if (value instanceof Uint8Array ) {\n      //@ts-ignore\n      return base64.decode(getStr(val, name));\n    }\n    //@ts-ignore\n    // assert(val instanceof Arr, "Value with Key: " +  name + " with type " + nameof<T>()  + " is expected to be an array")\n    //@ts-ignore only checking the instance\n    return <T>decodeArray<valueof<T>>(val, name);\n  }\n  //@ts-ignore\n  if (value instanceof u128) {\n    assert(val instanceof Str);\n    //@ts-ignore\n    return u128.fromString(getStr(val, name));\n  }\n  assert(val instanceof Obj, "Value with Key: " +  name + " with type " + nameof<T>()  + " is not an object or null");\n  value = instantiate<T>();\n  //@ts-ignore\n  return value.decode<Obj>(<Obj>val);\n}\n',"nearFile",!0),e.isTest||o.TypeChecker.check(t)},e.prototype.afterCompile=function(t){e.isTest||o.TypeChecker.checkBinary(t)},e.isTest=!1,e}(r.Transform),m='import { JSONEncoder } from "assemblyscript-json";';t.exports=f},function(t,e){e.Transform=function(){}},function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(2),o=["builtin",".spec","dataview","date","math","number","string","typedarray","bindings/Date","bindings/Math"],a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.check=function(t){t.text.substring(0,t.text.indexOf("\n")).includes("ignore")||o.some((function(e){return t.normalizedPath.includes(e)}))||this.visit(t)},e.check=function(t){for(var i=new e,s=0;s<t.program.sources.length;s++)i.check(t.program.sources[s])},e.prototype.visitTypeName=function(t){/f32|f64/.test(t.identifier.text)&&e.floatsFound.push(t.range.source.normalizedPath+" line: "+t.range.line+" "+t.range.source.text.split("\n")[t.range.line-1])},e.checkBinary=function(t){var i=t.toText();if(/f32|f64/.test(i))throw new Error("Floating point numbers are not allowed in smart contracts: Check\n"+e.floatsFound.join("\n"))},e.floatsFound=[],e}(r.BaseVisitor);e.TypeChecker=a},function(t,e,i){"use strict";var s=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},n=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,n,r=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return o};Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.visit=function(t){var e,i,r,o,a,p=this;if(null!=t)if(t instanceof Array)t.map((function(t){p.visit(t)}));else if(t instanceof Map)try{for(var h=s(t.entries()),u=h.next();!u.done;u=h.next()){var l=n(u.value,2),c=(l[0],l[1]);this.visit(c)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(e)throw e.error}}else if(null!=(a=t)&&"function"==typeof a[Symbol.iterator])try{for(var d=s(t),v=d.next();!v.done;v=d.next()){c=v.value;this.visit(c)}}catch(t){r={error:t}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}else this._visit(t)},t}();e.AbstractVisitor=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),n=function(){function t(){this.sb=[],this.indentLevel=0}return t.build=function(e){var i=new t;return i.visitNode(e),i.finish()},t.prototype.visitNode=function(t){switch(t.kind){case s.NodeKind.SOURCE:this.visitSource(t);break;case s.NodeKind.NAMEDTYPE:this.visitNamedTypeNode(t);break;case s.NodeKind.FUNCTIONTYPE:this.visitFunctionTypeNode(t);break;case s.NodeKind.TYPEPARAMETER:this.visitTypeParameter(t);break;case s.NodeKind.FALSE:case s.NodeKind.NULL:case s.NodeKind.SUPER:case s.NodeKind.THIS:case s.NodeKind.TRUE:case s.NodeKind.CONSTRUCTOR:case s.NodeKind.IDENTIFIER:this.visitIdentifierExpression(t);break;case s.NodeKind.ASSERTION:this.visitAssertionExpression(t);break;case s.NodeKind.BINARY:this.visitBinaryExpression(t);break;case s.NodeKind.CALL:this.visitCallExpression(t);break;case s.NodeKind.CLASS:this.visitClassExpression(t);break;case s.NodeKind.COMMA:this.visitCommaExpression(t);break;case s.NodeKind.ELEMENTACCESS:this.visitElementAccessExpression(t);break;case s.NodeKind.FUNCTION:this.visitFunctionExpression(t);break;case s.NodeKind.INSTANCEOF:this.visitInstanceOfExpression(t);break;case s.NodeKind.LITERAL:this.visitLiteralExpression(t);break;case s.NodeKind.NEW:this.visitNewExpression(t);break;case s.NodeKind.PARENTHESIZED:this.visitParenthesizedExpression(t);break;case s.NodeKind.PROPERTYACCESS:this.visitPropertyAccessExpression(t);break;case s.NodeKind.TERNARY:this.visitTernaryExpression(t);break;case s.NodeKind.UNARYPOSTFIX:this.visitUnaryPostfixExpression(t);break;case s.NodeKind.UNARYPREFIX:this.visitUnaryPrefixExpression(t);break;case s.NodeKind.BLOCK:this.visitBlockStatement(t);break;case s.NodeKind.BREAK:this.visitBreakStatement(t);break;case s.NodeKind.CONTINUE:this.visitContinueStatement(t);break;case s.NodeKind.DO:this.visitDoStatement(t);break;case s.NodeKind.EMPTY:this.visitEmptyStatement(t);break;case s.NodeKind.EXPORT:this.visitExportStatement(t);break;case s.NodeKind.EXPORTDEFAULT:this.visitExportDefaultStatement(t);break;case s.NodeKind.EXPORTIMPORT:this.visitExportImportStatement(t);break;case s.NodeKind.EXPRESSION:this.visitExpressionStatement(t);break;case s.NodeKind.FOR:this.visitForStatement(t);break;case s.NodeKind.IF:this.visitIfStatement(t);break;case s.NodeKind.IMPORT:this.visitImportStatement(t);break;case s.NodeKind.RETURN:this.visitReturnStatement(t);break;case s.NodeKind.SWITCH:this.visitSwitchStatement(t);break;case s.NodeKind.THROW:this.visitThrowStatement(t);break;case s.NodeKind.TRY:this.visitTryStatement(t);break;case s.NodeKind.VARIABLE:this.visitVariableStatement(t);break;case s.NodeKind.WHILE:this.visitWhileStatement(t);break;case s.NodeKind.CLASSDECLARATION:this.visitClassDeclaration(t);break;case s.NodeKind.ENUMDECLARATION:this.visitEnumDeclaration(t);break;case s.NodeKind.ENUMVALUEDECLARATION:this.visitEnumValueDeclaration(t);break;case s.NodeKind.FIELDDECLARATION:this.visitFieldDeclaration(t);break;case s.NodeKind.FUNCTIONDECLARATION:this.visitFunctionDeclaration(t);break;case s.NodeKind.IMPORTDECLARATION:this.visitImportDeclaration(t);break;case s.NodeKind.INDEXSIGNATUREDECLARATION:this.visitIndexSignatureDeclaration(t);break;case s.NodeKind.INTERFACEDECLARATION:this.visitInterfaceDeclaration(t);break;case s.NodeKind.METHODDECLARATION:this.visitMethodDeclaration(t);break;case s.NodeKind.NAMESPACEDECLARATION:this.visitNamespaceDeclaration(t);break;case s.NodeKind.TYPEDECLARATION:this.visitTypeDeclaration(t);break;case s.NodeKind.VARIABLEDECLARATION:this.visitVariableDeclaration(t);break;case s.NodeKind.DECORATOR:this.serializeDecorator(t);break;case s.NodeKind.EXPORTMEMBER:this.visitExportMember(t);break;case s.NodeKind.PARAMETER:this.serializeParameter(t);break;case s.NodeKind.SWITCHCASE:this.visitSwitchCase(t);break;default:assert(!1)}},t.prototype.visitSource=function(t){for(var e=t.statements,i=0,s=e.length;i<s;++i)this.visitNodeAndTerminate(e[i])},t.prototype.visitTypeNode=function(t){switch(t.kind){case s.NodeKind.NAMEDTYPE:this.visitNamedTypeNode(t);break;case s.NodeKind.FUNCTIONTYPE:this.visitFunctionTypeNode(t);break;default:assert(!1)}},t.prototype.visitTypeName=function(t){this.visitIdentifierExpression(t.identifier);for(var e=this.sb,i=t.next;i;)e.push("."),this.visitIdentifierExpression(i.identifier),i=i.next},t.prototype.visitNamedTypeNode=function(t){this.visitTypeName(t.name);var e=t.typeArguments;if(e){var i=e.length,s=this.sb;if(i){s.push("<"),this.visitTypeNode(e[0]);for(var n=1;n<i;++n)s.push(", "),this.visitTypeNode(e[n]);s.push(">")}t.isNullable&&s.push(" | null")}},t.prototype.visitFunctionTypeNode=function(t){var e=t.isNullable,i=this.sb;i.push(e?"((":"(");var s=t.explicitThisType;s&&(i.push("this: "),this.visitTypeNode(s));var n=t.parameters,r=n.length;if(r){s&&i.push(", "),this.serializeParameter(n[0]);for(var o=1;o<r;++o)i.push(", "),this.serializeParameter(n[o])}var a=t.returnType;a?(i.push(") => "),this.visitTypeNode(a)):i.push(") => void"),e&&i.push(") | null")},t.prototype.visitTypeParameter=function(t){this.visitIdentifierExpression(t.name);var e=t.extendsType;e&&(this.sb.push(" extends "),this.visitTypeNode(e));var i=t.defaultType;i&&(this.sb.push("="),this.visitTypeNode(i))},t.prototype.visitIdentifierExpression=function(t){t.isQuoted?this.visitStringLiteral(t.text):this.sb.push(t.text)},t.prototype.visitArrayLiteralExpression=function(t){var e=this.sb;e.push("[");var i=t.elementExpressions,s=i.length;if(s){i[0]&&this.visitNode(i[0]);for(var n=1;n<s;++n)e.push(", "),i[n]&&this.visitNode(i[n])}e.push("]")},t.prototype.visitObjectLiteralExpression=function(t){var e=this.sb,i=t.names,n=t.values,r=i.length;if(assert(r==n.length),r){e.push("{\n"),s.indent(e,++this.indentLevel),this.visitNode(i[0]),e.push(": "),this.visitNode(n[0]);for(var o=1;o<r;++o){e.push(",\n"),s.indent(e,this.indentLevel);var a=i[o],p=n[o];a===p?this.visitNode(a):(this.visitNode(a),e.push(": "),this.visitNode(p))}e.push("\n"),s.indent(e,--this.indentLevel),e.push("}")}else e.push("{}")},t.prototype.visitAssertionExpression=function(t){var e=this.sb;switch(t.assertionKind){case s.AssertionKind.PREFIX:e.push("<"),this.visitTypeNode(assert(t.toType)),e.push(">"),this.visitNode(t.expression);break;case s.AssertionKind.AS:this.visitNode(t.expression),e.push(" as "),this.visitTypeNode(assert(t.toType));break;case s.AssertionKind.NONNULL:this.visitNode(t.expression),e.push("!");break;default:assert(!1)}},t.prototype.visitBinaryExpression=function(t){var e=this.sb;this.visitNode(t.left),e.push(" "),e.push(s.operatorTokenToString(t.operator)),e.push(" "),this.visitNode(t.right)},t.prototype.visitCallExpression=function(t){var e=this.sb;this.visitNode(t.expression);var i=t.typeArguments;if(i){var s=i.length;if(s){e.push("<"),this.visitTypeNode(i[0]);for(var n=1;n<s;++n)e.push(", "),this.visitTypeNode(i[n]);e.push(">(")}}else e.push("(");var r=t.arguments,o=r.length;if(o){this.visitNode(r[0]);for(n=1;n<o;++n)e.push(", "),this.visitNode(r[n])}e.push(")")},t.prototype.visitClassExpression=function(t){var e=t.declaration;this.visitClassDeclaration(e)},t.prototype.visitCommaExpression=function(t){var e=t.expressions,i=assert(e.length);this.visitNode(e[0]);for(var s=this.sb,n=1;n<i;++n)s.push(","),this.visitNode(e[n])},t.prototype.visitElementAccessExpression=function(t){var e=this.sb;this.visitNode(t.expression),e.push("["),this.visitNode(t.elementExpression),e.push("]")},t.prototype.visitFunctionExpression=function(t){var e=t.declaration;e.arrowKind?assert(0==e.name.text.length):e.name.text.length?this.sb.push("function "):this.sb.push("function"),this.visitFunctionCommon(e)},t.prototype.visitLiteralExpression=function(t){switch(t.literalKind){case s.LiteralKind.FLOAT:this.visitFloatLiteralExpression(t);break;case s.LiteralKind.INTEGER:this.visitIntegerLiteralExpression(t);break;case s.LiteralKind.STRING:this.visitStringLiteralExpression(t);break;case s.LiteralKind.REGEXP:this.visitRegexpLiteralExpression(t);break;case s.LiteralKind.ARRAY:this.visitArrayLiteralExpression(t);break;case s.LiteralKind.OBJECT:this.visitObjectLiteralExpression(t);break;default:assert(!1)}},t.prototype.visitFloatLiteralExpression=function(t){this.sb.push(t.value.toString(10))},t.prototype.visitInstanceOfExpression=function(t){this.visitNode(t.expression),this.sb.push(" instanceof "),this.visitTypeNode(t.isType)},t.prototype.visitIntegerLiteralExpression=function(t){this.sb.push(i64_to_string(t.value))},t.prototype.visitStringLiteral=function(t,e){void 0===e&&(e=!1);var i=this.sb,s=0,n=e?"'":'"';i.push(n);for(var r=0,o=t.length;r<o;)switch(t.charCodeAt(r)){case 0:r>s&&i.push(t.substring(s,s=r+1)),i.push("\\0"),s=++r;break;case 8:r>s&&i.push(t.substring(s,r)),s=++r,i.push("\\b");break;case 9:r>s&&i.push(t.substring(s,r)),s=++r,i.push("\\t");break;case 10:r>s&&i.push(t.substring(s,r)),s=++r,i.push("\\n");break;case 11:r>s&&i.push(t.substring(s,r)),s=++r,i.push("\\v");break;case 12:r>s&&i.push(t.substring(s,r)),s=++r,i.push("\\f");break;case 13:r>s&&i.push(t.substring(s,r)),i.push("\\r"),s=++r;break;case 34:e?++r:(r>s&&i.push(t.substring(s,r)),i.push('\\"'),s=++r);break;case 39:e?(r>s&&i.push(t.substring(s,r)),i.push("\\'"),s=++r):++r;break;case 92:r>s&&i.push(t.substring(s,r)),i.push("\\\\"),s=++r;break;default:++r}r>s&&i.push(t.substring(s,r)),i.push(n)},t.prototype.visitStringLiteralExpression=function(t){this.visitStringLiteral(t.value)},t.prototype.visitRegexpLiteralExpression=function(t){var e=this.sb;e.push("/"),e.push(t.pattern),e.push("/"),e.push(t.patternFlags)},t.prototype.visitNewExpression=function(t){this.sb.push("new "),this.visitCallExpression(t)},t.prototype.visitParenthesizedExpression=function(t){var e=this.sb;e.push("("),this.visitNode(t.expression),e.push(")")},t.prototype.visitPropertyAccessExpression=function(t){this.visitNode(t.expression),this.sb.push("."),this.visitIdentifierExpression(t.property)},t.prototype.visitTernaryExpression=function(t){var e=this.sb;this.visitNode(t.condition),e.push(" ? "),this.visitNode(t.ifThen),e.push(" : "),this.visitNode(t.ifElse)},t.prototype.visitUnaryExpression=function(t){switch(t.kind){case s.NodeKind.UNARYPOSTFIX:this.visitUnaryPostfixExpression(t);break;case s.NodeKind.UNARYPREFIX:this.visitUnaryPrefixExpression(t);break;default:assert(!1)}},t.prototype.visitUnaryPostfixExpression=function(t){this.visitNode(t.operand),this.sb.push(s.operatorTokenToString(t.operator))},t.prototype.visitUnaryPrefixExpression=function(t){this.sb.push(s.operatorTokenToString(t.operator)),this.visitNode(t.operand)},t.prototype.visitNodeAndTerminate=function(t){this.visitNode(t);var e=this.sb;if(e.length&&t.kind!=s.NodeKind.VARIABLE&&t.kind!=s.NodeKind.EXPRESSION){var i=e[e.length-1],n=i.length-1;n>=0&&(125==i.charCodeAt(n)||59==i.charCodeAt(n))?e.push("\n"):e.push(";\n")}else e.push(";\n")},t.prototype.visitBlockStatement=function(t){var e=this.sb,i=t.statements,n=i.length;if(n){e.push("{\n");for(var r=++this.indentLevel,o=0;o<n;++o)s.indent(e,r),this.visitNodeAndTerminate(i[o]);s.indent(e,--this.indentLevel),e.push("}")}else e.push("{}")},t.prototype.visitBreakStatement=function(t){var e=t.label;e?(this.sb.push("break "),this.visitIdentifierExpression(e)):this.sb.push("break")},t.prototype.visitContinueStatement=function(t){var e=t.label;e?(this.sb.push("continue "),this.visitIdentifierExpression(e)):this.sb.push("continue")},t.prototype.visitClassDeclaration=function(t,e){void 0===e&&(e=!1);var i=t.decorators;if(i)for(var n=0,r=i.length;n<r;++n)this.serializeDecorator(i[n]);var o=this.sb;e?o.push("export default "):this.serializeExternalModifiers(t),t.is(s.CommonFlags.ABSTRACT)&&o.push("abstract "),t.name.text.length?(o.push("class "),this.visitIdentifierExpression(t.name)):o.push("class");var a=t.typeParameters;if(a&&a.length){o.push("<"),this.visitTypeParameter(a[0]);for(n=1,r=a.length;n<r;++n)o.push(", "),this.visitTypeParameter(a[n]);o.push(">")}var p=t.extendsType;p&&(o.push(" extends "),this.visitTypeNode(p));var h=t.implementsTypes;if(h){var u=h.length;if(u){o.push(" implements "),this.visitTypeNode(h[0]);for(n=1;n<u;++n)o.push(", "),this.visitTypeNode(h[n])}}var l=t.members;if(l.length){o.push(" {\n");var c=++this.indentLevel;for(n=0,r=l.length;n<r;++n){var d=l[n];(d.kind!=s.NodeKind.FIELDDECLARATION||d.parameterIndex<0)&&(s.indent(o,c),this.visitNodeAndTerminate(d))}s.indent(o,--this.indentLevel),o.push("}")}else o.push(" {}")},t.prototype.visitDoStatement=function(t){var e=this.sb;e.push("do "),this.visitNode(t.statement),t.statement.kind==s.NodeKind.BLOCK?e.push(" while ("):(e.push(";\n"),s.indent(e,this.indentLevel),e.push("while (")),this.visitNode(t.condition),e.push(")")},t.prototype.visitEmptyStatement=function(t){},t.prototype.visitEnumDeclaration=function(t,e){void 0===e&&(e=!1);var i=this.sb;e?i.push("export default "):this.serializeExternalModifiers(t),t.is(s.CommonFlags.CONST)&&i.push("const "),i.push("enum "),this.visitIdentifierExpression(t.name);var n=t.values.length;if(n){i.push(" {\n");var r=++this.indentLevel;s.indent(i,r),this.visitEnumValueDeclaration(t.values[0]);for(var o=1;o<n;++o)i.push(",\n"),s.indent(i,r),this.visitEnumValueDeclaration(t.values[o]);i.push("\n"),s.indent(i,--this.indentLevel),i.push("}")}else i.push(" {}")},t.prototype.visitEnumValueDeclaration=function(t){this.visitIdentifierExpression(t.name),t.value&&(this.sb.push(" = "),this.visitNode(t.value))},t.prototype.visitExportImportStatement=function(t){var e=this.sb;e.push("export import "),this.visitIdentifierExpression(t.externalName),e.push(" = "),this.visitIdentifierExpression(t.name)},t.prototype.visitExportMember=function(t){this.visitIdentifierExpression(t.localName),t.exportedName.text!=t.localName.text&&(this.sb.push(" as "),this.visitIdentifierExpression(t.exportedName))},t.prototype.visitExportStatement=function(t){var e=this.sb;t.isDeclare&&e.push("declare ");var i=t.members;if(i&&i.length){var n=i.length;e.push("export {\n");var r=++this.indentLevel;s.indent(e,r),this.visitExportMember(i[0]);for(var o=1;o<n;++o)e.push(",\n"),s.indent(e,r),this.visitExportMember(i[o]);--this.indentLevel,e.push("\n}")}else e.push("export {}");var a=t.path;a&&(e.push(" from "),this.visitStringLiteralExpression(a)),e.push(";")},t.prototype.visitExportDefaultStatement=function(t){var e=t.declaration;switch(e.kind){case s.NodeKind.ENUMDECLARATION:this.visitEnumDeclaration(e,!0);break;case s.NodeKind.FUNCTIONDECLARATION:this.visitFunctionDeclaration(e,!0);break;case s.NodeKind.CLASSDECLARATION:this.visitClassDeclaration(e,!0);break;case s.NodeKind.INTERFACEDECLARATION:this.visitInterfaceDeclaration(e,!0);break;case s.NodeKind.NAMESPACEDECLARATION:this.visitNamespaceDeclaration(e,!0);break;default:assert(!1)}},t.prototype.visitExpressionStatement=function(t){this.visitNode(t.expression)},t.prototype.visitFieldDeclaration=function(t){var e=t.decorators;if(e)for(var i=0,n=e.length;i<n;++i)this.serializeDecorator(e[i]);this.serializeAccessModifiers(t),this.visitIdentifierExpression(t.name);var r=this.sb;t.flags&s.CommonFlags.DEFINITE_ASSIGNMENT&&r.push("!");var o=t.type;o&&(r.push(": "),this.visitTypeNode(o));var a=t.initializer;a&&(r.push(" = "),this.visitNode(a))},t.prototype.visitForStatement=function(t){var e=this.sb;e.push("for (");var i=t.initializer;i&&this.visitNode(i);var s=t.condition;s?(e.push("; "),this.visitNode(s)):e.push(";");var n=t.incrementor;n?(e.push("; "),this.visitNode(n)):e.push(";"),e.push(") "),this.visitNode(t.statement)},t.prototype.visitFunctionDeclaration=function(t,e){void 0===e&&(e=!1);var i=this.sb,s=t.decorators;if(s)for(var n=0,r=s.length;n<r;++n)this.serializeDecorator(s[n]);e?i.push("export default "):(this.serializeExternalModifiers(t),this.serializeAccessModifiers(t)),t.name.text.length?i.push("function "):i.push("function"),this.visitFunctionCommon(t)},t.prototype.visitFunctionCommon=function(t){var e=this.sb;this.visitIdentifierExpression(t.name);var i=t.signature,n=t.typeParameters;if(n){var r=n.length;if(r){e.push("<"),this.visitTypeParameter(n[0]);for(var o=1;o<r;++o)e.push(", "),this.visitTypeParameter(n[o]);e.push(">")}}if(2==t.arrowKind){var a=i.parameters;assert(1==a.length),assert(!i.explicitThisType),this.serializeParameter(a[0])}else{e.push("(");var p=(a=i.parameters).length,h=i.explicitThisType;if(h&&(e.push("this: "),this.visitTypeNode(h)),p){h&&e.push(", "),this.serializeParameter(a[0]);for(o=1;o<p;++o)e.push(", "),this.serializeParameter(a[o])}}var u=t.body,l=i.returnType;t.arrowKind?u?(2==t.arrowKind?assert(s.isTypeOmitted(l)):s.isTypeOmitted(l)?e.push(")"):(e.push("): "),this.visitTypeNode(l)),e.push(" => "),this.visitNode(u)):(assert(!s.isTypeOmitted(l)),e.push(" => "),this.visitTypeNode(l)):(s.isTypeOmitted(l)||t.isAny(s.CommonFlags.CONSTRUCTOR|s.CommonFlags.SET)?e.push(")"):(e.push("): "),this.visitTypeNode(l)),u&&(e.push(" "),this.visitNode(u)))},t.prototype.visitIfStatement=function(t){var e=this.sb;e.push("if ("),this.visitNode(t.condition),e.push(") ");var i=t.ifTrue;this.visitNode(i),i.kind!=s.NodeKind.BLOCK&&e.push(";\n");var n=t.ifFalse;n&&(i.kind==s.NodeKind.BLOCK?e.push(" else "):e.push("else "),this.visitNode(n))},t.prototype.visitImportDeclaration=function(t){var e=t.foreignName,i=t.name;this.visitIdentifierExpression(e),e.text!=i.text&&(this.sb.push(" as "),this.visitIdentifierExpression(i))},t.prototype.visitImportStatement=function(t){var e=this.sb;e.push("import ");var i=t.declarations,n=t.namespaceName;if(i){var r=i.length;if(r){e.push("{\n");var o=++this.indentLevel;s.indent(e,o),this.visitImportDeclaration(i[0]);for(var a=1;a<r;++a)e.push(",\n"),s.indent(e,o),this.visitImportDeclaration(i[a]);--this.indentLevel,e.push("\n} from ")}else e.push("{} from ")}else n&&(e.push("* as "),this.visitIdentifierExpression(n),e.push(" from "));this.visitStringLiteralExpression(t.path)},t.prototype.visitIndexSignatureDeclaration=function(t){var e=this.sb;e.push("[key: "),this.visitTypeNode(t.keyType),e.push("]: "),this.visitTypeNode(t.valueType)},t.prototype.visitInterfaceDeclaration=function(t,e){void 0===e&&(e=!1);var i=t.decorators;if(i)for(var n=0,r=i.length;n<r;++n)this.serializeDecorator(i[n]);var o=this.sb;e?o.push("export default "):this.serializeExternalModifiers(t),o.push("interface "),this.visitIdentifierExpression(t.name);var a=t.typeParameters;if(a&&a.length){o.push("<"),this.visitTypeParameter(a[0]);for(n=1,r=a.length;n<r;++n)o.push(", "),this.visitTypeParameter(a[n]);o.push(">")}var p=t.extendsType;p&&(o.push(" extends "),this.visitTypeNode(p)),o.push(" {\n");var h=++this.indentLevel,u=t.members;for(n=0,r=u.length;n<r;++n)s.indent(o,h),this.visitNodeAndTerminate(u[n]);--this.indentLevel,o.push("}")},t.prototype.visitMethodDeclaration=function(t){var e=t.decorators;if(e)for(var i=0,n=e.length;i<n;++i)this.serializeDecorator(e[i]);this.serializeAccessModifiers(t),t.is(s.CommonFlags.GET)?this.sb.push("get "):t.is(s.CommonFlags.SET)&&this.sb.push("set "),this.visitFunctionCommon(t)},t.prototype.visitNamespaceDeclaration=function(t,e){void 0===e&&(e=!1);var i=t.decorators;if(i)for(var n=0,r=i.length;n<r;++n)this.serializeDecorator(i[n]);var o=this.sb;e?o.push("export default "):this.serializeExternalModifiers(t),o.push("namespace "),this.visitIdentifierExpression(t.name);var a=t.members;if(a.length){o.push(" {\n");var p=++this.indentLevel;for(n=0,r=a.length;n<r;++n)s.indent(o,p),this.visitNodeAndTerminate(a[n]);s.indent(o,--this.indentLevel),o.push("}")}else o.push(" {}")},t.prototype.visitReturnStatement=function(t){var e=t.value;e?(this.sb.push("return "),this.visitNode(e)):this.sb.push("return")},t.prototype.visitSwitchCase=function(t){var e=this.sb,i=t.label;i?(e.push("case "),this.visitNode(i),e.push(":\n")):e.push("default:\n");var n=t.statements,r=n.length;if(r){var o=++this.indentLevel;s.indent(e,o),this.visitNodeAndTerminate(n[0]);for(var a=1;a<r;++a)s.indent(e,o),this.visitNodeAndTerminate(n[a]);--this.indentLevel}},t.prototype.visitSwitchStatement=function(t){var e=this.sb;e.push("switch ("),this.visitNode(t.condition),e.push(") {\n");for(var i=++this.indentLevel,n=t.cases,r=0,o=n.length;r<o;++r)s.indent(e,i),this.visitSwitchCase(n[r]),e.push("\n");--this.indentLevel,e.push("}")},t.prototype.visitThrowStatement=function(t){this.sb.push("throw "),this.visitNode(t.value)},t.prototype.visitTryStatement=function(t){var e=this.sb;e.push("try {\n");for(var i=++this.indentLevel,n=t.statements,r=0,o=n.length;r<o;++r)s.indent(e,i),this.visitNodeAndTerminate(n[r]);var a=t.catchVariable;if(a){s.indent(e,i-1),e.push("} catch ("),this.visitIdentifierExpression(a),e.push(") {\n");var p=t.catchStatements;if(p)for(r=0,o=p.length;r<o;++r)s.indent(e,i),this.visitNodeAndTerminate(p[r])}var h=t.finallyStatements;if(h){s.indent(e,i-1),e.push("} finally {\n");for(r=0,o=h.length;r<o;++r)s.indent(e,i),this.visitNodeAndTerminate(h[r])}s.indent(e,i-1),e.push("}")},t.prototype.visitTypeDeclaration=function(t){var e=t.decorators;if(e)for(var i=0,s=e.length;i<s;++i)this.serializeDecorator(e[i]);var n=this.sb;this.serializeExternalModifiers(t),n.push("type "),this.visitIdentifierExpression(t.name);var r=t.typeParameters;if(r){var o=r.length;if(o){n.push("<");for(i=0;i<o;++i)this.visitTypeParameter(r[i]);n.push(">")}}n.push(" = "),this.visitTypeNode(t.type)},t.prototype.visitVariableDeclaration=function(t){this.visitIdentifierExpression(t.name);var e=t.type,i=this.sb;t.flags&s.CommonFlags.DEFINITE_ASSIGNMENT&&i.push("!"),e&&(i.push(": "),this.visitTypeNode(e));var n=t.initializer;n&&(i.push(" = "),this.visitNode(n))},t.prototype.visitVariableStatement=function(t){var e=t.decorators;if(e)for(var i=0,n=e.length;i<n;++i)this.serializeDecorator(e[i]);var r=this.sb,o=t.declarations,a=assert(o.length),p=o[0];this.serializeExternalModifiers(p),r.push(p.is(s.CommonFlags.CONST)?"const ":p.is(s.CommonFlags.LET)?"let ":"var "),this.visitVariableDeclaration(t.declarations[0]);for(i=1;i<a;++i)r.push(", "),this.visitVariableDeclaration(t.declarations[i])},t.prototype.visitWhileStatement=function(t){var e=this.sb;e.push("while ("),this.visitNode(t.condition),t.statement.kind==s.NodeKind.EMPTY?e.push(")"):(e.push(") "),this.visitNode(t.statement))},t.prototype.serializeDecorator=function(t){var e=this.sb;e.push("@"),this.visitNode(t.name);var i=t.arguments;if(i){e.push("(");var n=i.length;if(n){this.visitNode(i[0]);for(var r=1;r<n;++r)e.push(", "),this.visitNode(i[r])}e.push(")\n")}else e.push("\n");s.indent(e,this.indentLevel)},t.prototype.serializeParameter=function(t){var e=this.sb,i=t.parameterKind,n=t.implicitFieldDeclaration;n&&this.serializeAccessModifiers(n),i==s.ParameterKind.REST&&e.push("..."),this.visitIdentifierExpression(t.name);var r=t.type,o=t.initializer;r&&(i!=s.ParameterKind.OPTIONAL||o||e.push("?"),s.isTypeOmitted(r)||(e.push(": "),this.visitTypeNode(r))),o&&(e.push(" = "),this.visitNode(o))},t.prototype.serializeExternalModifiers=function(t){var e=this.sb;t.is(s.CommonFlags.EXPORT)?e.push("export "):t.is(s.CommonFlags.IMPORT)?e.push("import "):t.is(s.CommonFlags.DECLARE)&&e.push("declare ")},t.prototype.serializeAccessModifiers=function(t){var e=this.sb;t.is(s.CommonFlags.PUBLIC)?e.push("public "):t.is(s.CommonFlags.PRIVATE)?e.push("private "):t.is(s.CommonFlags.PROTECTED)&&e.push("protected "),t.is(s.CommonFlags.STATIC)?e.push("static "):t.is(s.CommonFlags.ABSTRACT)&&e.push("abstract "),t.is(s.CommonFlags.READONLY)&&e.push("readonly ")},t.prototype.finish=function(){var t=this.sb.join("");return this.sb=[],t},t}();e.ASTBuilder=n}])}));